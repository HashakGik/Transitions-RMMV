<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Iris.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Iris.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var Transitions = (function (my) {

    /**
     * Mechanical iris transition. Divides the old scene in six blades, opening a hole in the center which reveals the new scene.
     * @constructor
     * @memberOf Transitions
     * @extends Transitions.Transition_Base
     */
    var Transition_Iris = my.Transition_Iris = function () {
        this.initialize.apply(this, arguments);
    };

    Transition_Iris.prototype = Object.create(my.Transition_Base.prototype);
    Transition_Iris.prototype.constructor = Transition_Iris;

    /**
     * Constructor.
     * @param screen Sprite on which the transition will be drawn.
     * @param white Ignored.
     * @param fadeSign Sign parameter. Only fade outs (+1) will melt the screen.
     */
    Transition_Iris.prototype.initialize = function (screen, white, fadeSign) {
        my.Transition_Base.prototype.initialize.call(this, screen, white, fadeSign);

        this.blades = 6;
        this.snaps = [];
        var w = $gameSystem.snap.width;
        var h = $gameSystem.snap.height;
        for (var i = 0; i &lt; this.blades; i++) {
            var bmp = new Bitmap(w, h);
            bmp.blt($gameSystem.snap, 0, 0, w, h, 0, 0, w, h);
            this.snaps.push(bmp);
        }
    };

    /**
     * Starts the effect. The actual duration is five times the passed value.
     * @param duration Duration of the effect.
     */
    Transition_Iris.prototype.start = function (duration) {
        if (this.fadeSign > 0) {
            var w = this.snaps[0].width;
            var h = this.snaps[0].height;
            var angle = 2 * Math.PI / this.snaps.length;
            var radius = Math.sqrt(w * w + h * h);


            for (var i = 0; i &lt; this.snaps.length; i++) {
                this.snaps[i]._context.globalCompositeOperation = 'destination-in';

                this.snaps[i]._context.fillStyle = "white";
                this.snaps[i]._context.beginPath();
                this.snaps[i]._context.moveTo(w / 2, h / 2);
                this.snaps[i]._context.lineTo(w / 2 + radius * Math.cos(angle * i), h / 2 + radius * Math.sin(angle * i));
                for (var j = 1; j &lt; Math.floor(this.snaps.length / 2); j++) {
                    this.snaps[i]._context.lineTo(w / 2 + radius * Math.cos(angle * ((i + j) % this.snaps.length)), h / 2 + radius * Math.sin(angle * ((i + j) % this.snaps.length)));
                }

                this.snaps[i]._context.lineTo(w / 2, h / 2);
                this.snaps[i]._context.closePath();
                this.snaps[i]._context.fill();

                this.screen._bitmap.blt(this.snaps[i], 0, 0, w, h, 0, 0, w, h);
            }


            this.distance = 0;

            this.duration = duration * 5;
            this.remainingDuration = duration * 5;
            this.active = true;
        }
    };

    Transition_Iris.prototype.update = function () {
        if (this.active) {
            var w = this.snaps[0].width;
            var h = this.snaps[0].height;
            var angle = 2 * Math.PI / this.snaps.length;
            this.screen._bitmap.clear();



            for (var i = 0; i &lt; this.snaps.length; i++) {
                this.screen._bitmap.blt(this.snaps[i], 0, 0, w, h, this.distance * Math.cos(angle * i), this.distance * Math.sin(angle * i), w, h);
            }

            this.distance += Math.max(w, h) / this.duration;

            this.active = this.distance &lt;= Math.sqrt(w * w + h * h);

            this.remainingDuration--;
        }
    };

    my.transitions['iris'] = "my.Transition_Iris";

    return my;
})(Transitions || {});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="Transitions.html">Transitions</a></li></ul><h3>Classes</h3><ul><li><a href="Transitions.Transition_Base.html">Transition_Base</a></li><li><a href="Transitions.Transition_Cut.html">Transition_Cut</a></li><li><a href="Transitions.Transition_Iris.html">Transition_Iris</a></li><li><a href="Transitions.Transition_Melt.html">Transition_Melt</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.2</a> on Thu Sep 05 2019 21:35:35 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
